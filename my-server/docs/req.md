# **요구사항 분석**

## 목차

- [요구사항 1: 조회와 가입](#요구사항-1--조회와-가입)
- [요구사항 2: 점유 방식](#요구사항-2--점유-방식)
- [요구사항 3: 본인의 연구자/논문 정보 수정](#요구사항-3--본인의-연구자논문-정보-수정)
- [요구사항 4: 탈퇴 및 소프트 딜리트](#요구사항-4--탈퇴-및-소프트-딜리트)

## **요구사항 1 : 조회와 가입**

> - 연구자들은 수집된 데이터를 바탕으로 가입할 수 있습니다.
> - 아무나 본인의 데이터라고 생각되는 데이터로 가입할 수 있습니다.
> - 첫 가입시 본인 이름을 직접 검색으로 찾을지, 가입한 이름 기반으로 자동으로 목록을 제공하여 선택하게 할지 등은 자율입니다.
> - 수집된 연구자와 가입한 연구자들의 전체 목록을 GET할 수 있는 API가 있어야합니다. 다만, 수집된 연구자 데이터 중에 이미 가입이 연동된 연구자 데이터는 제외되어야합니다.

### **💡 구현 방안**

- **'수집된 연구자 데이터' 조회 에서 '가입이 연동된 연구자 데이터'가 있다면 덮어씌우는 것이 핵심**
- `etl_researcher_raw`에 `researcher`를 `LEFT JOIN`하여 조회, 항상 raw 데이터를 fallback
    - `researcher.data ?? raw.data`
- `researcher`은 연구자 조회에서 언제나 우선되는 데이터이다.
  `etl_researcher_raw`의 모든 필드를 복사해놓으면 연구자 데이터 조회 시 조인이 필요없다는 장점이 있지만, raw 데이터는 ETL 파이프라인에 의해 매달 최신화되므로 동기화 비용이 증가하고 실제 필드 수정이 다양하게 이루어지지 않는다면 저장공간이 낭비가 되는 단점이 있다.따라서 `researcher`에는 수정되는 데이터에 해당하는 필드만 셋팅하고 나머지는 null로 비워놓도록 설계한다.
- **본인이라 생각되는 데이터를 선택하는 방식:**
  가입한 이름 기반으로 `etlResearcherRaws` 목록을 조회 → 선택(연결)

## **요구사항 2 : 점유 방식**

> - 한 번 가입된 데이터는 다른 연구자가 신청하여 가입할 수 없습니다.
> - 예를 들어서, researcher_id=1234 인 row로 가입을 했다면, **그 엔티티는 점유**되어 다른 유저는 본인이 1234 연구자라고 주장할 수 없습니다.

### **💡 구현 방안**

- 데이터 선택 시 `member_id`와 `etl_researcher_raw_id`(UNIQUE)를 셋팅한 `researcher` 레코드 삽입
    - 에러: "이미 가입한 연구자의 데이터를 선택하실 수 없습니다."(`researcher`에 레코드 삽입 시 중복 `etl_researcher_raw_id` 쓰는 레코드 이미 존재)

## **요구사항 3 : 본인의 연구자/논문 정보 수정**

> - 가입한 연구자는 **수집한 데이터를 기반으로 ← 본인 정보와 본인 논문 정보를 수정할 수 있습니다.**

### **💡 구현 방안**

- 연구자 데이터 선택 시 `member_id` 및 raw 데이터의 id를 셋팅한 `researcher` 레코드와 함께 `paper` 레코드들도 함께 삽입
    - data-server에 의하면 인당 평균 10개 이하의 논문을 쓰므로 문제없음.
- raw 데이터와 다르게 수정된 내용이 있다면 `researcher`나 `paper`에 셋팅

## **요구사항 4 : 탈퇴 및 소프트 딜리트**

> - 가입했던 연구자가 탈퇴되게 되면 다른 사람이 다시 그 데이터를 기반으로 가입 할 수 있습니다.
> - 180일 동안 가입했던 연구자가 본인 프로필을 수정하지 않으면 자동으로 탈퇴처리됩니다.

### **💡 구현 방안**

- 프로필 수정 없이(= `researcher`의 `updated_at`으로부터) 180일이 지나면
    - 해당 멤버의 `researcher`, `paper` 레코드들에서 raw 데이터의 id를 null로 셋팅
    - 소프트 딜리트를 위한 필드 `status` 를 INACTIVE 로 셋팅
        - PENDING
        - ACTIVE
        - INACTIVE (180일 프로필 수정 없음 등)
        - DELETED (유저 스스로 탈퇴 등)
- 스케줄링